USE MASTER
GO

IF DB_ID('QLDeAnCongTy') IS NOT NULL
DROP DATABASE QLDeAnCongTy
GO

CREATE DATABASE QLDeAnCongTy
GO

USE QLDeAnCongTy
SET DATEFORMAT DMY
GO

CREATE TABLE NHANVIEN
(
	MANV CHAR(5),
	HONV NVARCHAR(20),
	TENLOT NVARCHAR(20),
	TENNV NVARCHAR(20),
	NGSINH DATE,
	PHAI NCHAR(3),
	DCHI NVARCHAR(50),
	MA_NQL CHAR(5),
	PHONG CHAR(5),
	MLUONG FLOAT,
	CONSTRAINT PK_NHANVIEN
	PRIMARY KEY(MANV)
)

CREATE TABLE PHONGBAN
(
	MAPHG CHAR(5),
	TENPHG NVARCHAR(20),
	TRPHG CHAR(5),
	NGNC TIME,
	CONSTRAINT PK_PHONGBAN
	PRIMARY KEY(MAPHG)
)

CREATE TABLE DIADIEM_PHG
(
	MAPHG CHAR(5),
	DIADIEM NVARCHAR(20),
	CONSTRAINT PK_DIADIEM_PHG
	PRIMARY KEY(MAPHG,DIADIEM)
)

CREATE TABLE DEAN
(
	MADA CHAR(5),
	TENDA NVARCHAR(20),
	DDIEM_DA NVARCHAR(20),
	PHONG CHAR(5),
	NGBD_DK TIME,
	NGKT_DK TIME,
	CONSTRAINT PK_DEAN
	PRIMARY KEY(MADA)
)

CREATE TABLE THANNHAN
(
	MANV CHAR(5),
	MATN CHAR(5),
	TENTN NVARCHAR(20),
	PHAI NCHAR(3),
	NGSINH TIME,
	QUANHE NVARCHAR(20),
	CONSTRAINT PK_THANNHAN
	PRIMARY KEY(MANV,MATN)
)

CREATE TABLE PHANCONG
(
	MANV CHAR(5),
	MADA CHAR(5),
	THOIGIAN FLOAT,
	CONSTRAINT PK_PHANCONG
	PRIMARY KEY(MANV,MADA)
)

ALTER TABLE NHANVIEN ADD
	CONSTRAINT FK_NHANVIEN_NHANVIEN FOREIGN KEY(MA_NQL) REFERENCES NHANVIEN(MANV)


ALTER TABLE PHONGBAN ADD
	CONSTRAINT FK_PHONGBAN_NHANVIEN FOREIGN KEY(TRPHG) REFERENCES NHANVIEN(MANV)

ALTER TABLE DIADIEM_PHG ADD
	CONSTRAINT FK_DIADIEM_PHG_PHONGBAN FOREIGN KEY(MAPHG) REFERENCES PHONGBAN(MAPHG)

ALTER TABLE DEAN ADD
	CONSTRAINT FK_DEAN_DIADIEM_PHG FOREIGN KEY(PHONG,DDIEM_DA) REFERENCES DIADIEM_PHG(MAPHG,DIADIEM),
	CONSTRAINT FK_DEAN_PHONGBAN FOREIGN KEY(PHONG) REFERENCES PHONGBAN(MAPHG)

ALTER TABLE THANNHAN ADD
	CONSTRAINT FK_THANNHAN_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE PHANCONG ADD
	CONSTRAINT FK_PHANCONG_NHANVIEN FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_PHANCONG_DEAN FOREIGN KEY(MADA) REFERENCES DEAN(MADA)


INSERT INTO NHANVIEN VALUES
	('001','Vuong','Ngoc','Quyen','22/10/1957','Nu','450 Trung Vuong, Ha Noi',NULL,'QL',3000000),
	('002','Nguyen','Thanh','Tung','09/01/1955','Nam','731 Tran Hung Daom Q1, Tp HCM','001','NC',2500000),
	('003','Le','Thi','Nhan','18/12/1960','Nu','291 Ho Van Hue, QPN, Tp HCM','001','DH',2500000),
	('004','Dinh','Ba','Tien','09/01/1968','Nam','638 Nguyen Van Cu, Q5, Tp HCM','002','NC',2200000),
	('005','Bui','Thuy','Vu','19/07/1972','Nam','332 Nguyen Thai Hoc, Q1, Tp HCM','003','DH',2200000),
	('006','Nguyen','Manh','Hung','15/09/1973','Nam','978 Ba Ria, Vung Tau','002','NC',2000000),
	('007','Tran','Thanh','Tam','31/07/1975','Nu','543 Mai Thi Luu, Q1, Tp HCM','002','NC',2200000),
	('008','Tran','Hong','Van','04/07/1976','Nu','980 Le Hong Phong, Q10, Tp HCM','004','NC',1800000)

INSERT INTO DEAN VALUES
	('TH001','Tin hoc hoa 1','HANOI',NULL,'01/02/2003','01/02/2004'),
	('TH002','Tin hoc hoa 2','TPHCM',NULL,'04/06/2003','01/02/2004'),
	('DT001','Dao Tao 1','NHATRANG',NULL,'01/02/2002','01/02/2006'),
	('DT002','Dao Tao 2','HANOI',NULL,'01/02/2002','01/02/2006')

INSERT INTO PHONGBAN VALUES
	('QL','Quan Ly','001','22/05/2000'),
	('DH','Dieu Hanh','003','10/10/2002'),
	('NC','Nghien Cuu','002','15/03/2002')

INSERT INTO THANNHAN VALUES
	('003','1','Tran Minh Tien','Nam','11/12/1990','Con'),
	('003','2','Tran Ngoc Linh','Nu','10/03/1993','Con'),
	('003','3','Tran Minh Long','Nam','10/10/1957','Vo Chong'),
	('001','1','Le Nhat Minh','Nam','27/04/1955','Vo Chong'),
	('002','1','Le Hoai Thuong','Nu','05/12/1960','Vo Chong'),
	('004','1','Le Phi Phung','Nu','23/12/1972','Vo Chong'),
	('005','1','Tran Thu Hong','Nu','11/04/1978','Vo Chong'),
	('005','2','Nguyen Manh Tam','Nam','13/01/2003','Con')

INSERT INTO DIADIEM_PHG VALUES
	('NC','HANOI'),
	('NC','TPHCM'),
	('QL','TPHCM'),
	('DH','HANOI'),
	('DH','TPHCM'),
	('DH','NHATRANG')

INSERT INTO PHANCONG VALUES
	('001','TH001',30.0),
	('001','TH002',12.5),
	('002','TH001',10.0),
	('002','TH002',10.0),
	('002','DT001',10.0),
	('002','DT002',10.0),
	('003','TH001',37.5),
	('004','DT001',22.5),
	('004','DT002',10.0),
	('006','DT001',30.5),
	('007','TH001',20.0),
	('007','TH002',10.0),
	('008','TH001',10.0),
	('008','DT002',12.5)

UPDATE DEAN SET PHONG='NC' WHERE MADA='TH001'
UPDATE DEAN SET PHONG='NC' WHERE MADA='TH002'
UPDATE DEAN SET PHONG='DH' WHERE MADA='DT001'
UPDATE DEAN SET PHONG='DH' WHERE MADA='DT002'

SELECT * FROM DBO.NHANVIEN
SELECT * FROM DBO.DEAN
SELECT * FROM DBO.PHONGBAN
SELECT * FROM DBO.THANNHAN
SELECT * FROM DBO.DIADIEM_PHG
SELECT * FROM DBO.PHANCONG


