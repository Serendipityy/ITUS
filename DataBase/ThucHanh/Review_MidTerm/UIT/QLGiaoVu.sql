USE MASTER
GO

IF DB_ID('QLGiaoVu') IS NOT NULL
DROP DATABASE QLGiaoVu
GO

CREATE DATABASE QLGiaoVu
GO

USE QLGiaoVu
SET DATEFORMAT DMY
GO

CREATE TABLE KHOA
(
	MAKHOA VARCHAR(4),
	TENKHOA VARCHAR(40),
	NGTLAP SMALLDATETIME,
	TRGKHOA CHAR(4),
	CONSTRAINT PK_KHOA
	PRIMARY KEY(MAKHOA)
)

CREATE TABLE MONHOC
(
	MAMH VARCHAR(10),
	TENMH VARCHAR(40),
	TCLT TINYINT,
	TCTH TINYINT,
	MAKHOA VARCHAR(4),
	CONSTRAINT PK_MONHOC
	PRIMARY KEY(MAMH)
)

CREATE TABLE DIEUKIEN
(
	MAMH VARCHAR(10),
	MAMH_TRUOC VARCHAR(10)
	CONSTRAINT PK_DIEUKIEN
	PRIMARY KEY(MAMH,MAMH_TRUOC)
)

CREATE TABLE GIAOVIEN
(
	MAGV CHAR(4),
	HOTEN VARCHAR(40),
	HOCVI VARCHAR(10),
	HOCHAM VARCHAR(10),
	GIOITINH VARCHAR(3),
	NGSINH SMALLDATETIME,
	NGVL SMALLDATETIME,
	HESO NUMERIC(4,2),
	MUCLUONG MONEY,
	MAKHOA VARCHAR(4)
	CONSTRAINT PK_GIAOVIEN
	PRIMARY KEY(MAGV)
)

CREATE TABLE LOP
(
	MALOP CHAR(3),
	TENLOP VARCHAR(40),
	TRGLOP CHAR(5),
	SISO TINYINT,
	MAGVCN CHAR(4),
	CONSTRAINT PK_LOP
	PRIMARY KEY(MALOP)
)

CREATE TABLE HOCVIEN
(
	MAHV CHAR(5),
	HO VARCHAR(40),
	TEN VARCHAR(10),
	NGSINH SMALLDATETIME,
	GIOITINH VARCHAR(3),
	NOISINH VARCHAR(40),
	MALOP CHAR(3),
	CONSTRAINT PK_HOCVIEN
	PRIMARY KEY(MAHV)
)

CREATE TABLE GIANGDAY
(
	MALOP CHAR(3),
	MAMH VARCHAR(10),
	MAGV CHAR(4),
	HOCKY TINYINT,
	NAM SMALLINT,
	TUNGAY SMALLDATETIME,
	DENNGAY SMALLDATETIME,
	CONSTRAINT PK_GIANGDAY
	PRIMARY KEY(MALOP,MAMH)
)

CREATE TABLE KETQUATHI
(
	MAHV CHAR(5),
	MAMH VARCHAR(10),
	LANTHI TINYINT,
	NGTHI SMALLDATETIME,
	DIEM NUMERIC(4,2),
	KQUA VARCHAR(10)
	CONSTRAINT PK_KETQUATHI
	PRIMARY KEY(MAHV,MAMH,LANTHI)
)

ALTER TABLE KHOA ADD
	CONSTRAINT FK_KHOA_GIAOVIEN FOREIGN KEY(TRGKHOA) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE MONHOC ADD
	CONSTRAINT FK_MONHOC_KHOA FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE DIEUKIEN ADD
	CONSTRAINT FK_DIEUKIEN_MONHOC FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH) 

ALTER TABLE GIAOVIEN ADD
	CONSTRAINT FK_GIAOVIEN_KHOA FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE LOP ADD
	CONSTRAINT FK_LOP_GIAOVIEN FOREIGN KEY(MAGVCN) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE HOCVIEN ADD
	CONSTRAINT FK_HOCVIEN_LOP FOREIGN KEY(MALOP) REFERENCES LOP(MALOP)

ALTER TABLE GIANGDAY ADD
	CONSTRAINT FK_GIANGDAY_LOP FOREIGN KEY(MALOP) REFERENCES LOP(MALOP),
	CONSTRAINT FK_GIANGDAY_MONHOC FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH),
	CONSTRAINT FK_GIANGDAY_GIAOVIEN FOREIGN KEY(MAGV) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KETQUATHI ADD
	CONSTRAINT FK_KETQUATHI_HOCVIEN FOREIGN KEY(MAHV) REFERENCES HOCVIEN(MAHV),
	CONSTRAINT FK_KETQUATHI_MONHOC FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH)

INSERT INTO KHOA VALUES
	('KHMT','Khoa hoc may tinh','7/6/2005',NULL),
	('HTTT','He thong thong tin','7/6/2005',NULL),
	('CNPM','Cong nghe phan mem','7/6/2005',NULL),
	('MMT','Mang va truyen thong','20/10/2005',NULL),
	('KTMT','Ky thuat may tinh','20/12/2005',NULL)


INSERT INTO LOP VALUES
	('K11','Lop 1 khoa 1','K1108',11,NULL),
	('K12','Lop 2 khoa 1','K1205',12,NULL),
	('K13','Lop 3 khoa 1','K1305',12,NULL)


INSERT INTO MONHOC VALUES
	('THDC','Tin hoc dai cuong',4,1,'KHMT'),
	('CTRR','Cau truc roi rac',5,0,'KHMT'),
	('CSDL','Co so du lieu',3,1,'HTTT'),
	('CTDLGT','Cau truc du lieu va giai thuat',3,1,'KHMT'),
	('PTTKTT','Phan tich thiet ke thuat toan',3,0,'KHMT'),
	('DHMT','Do hoa may tinh',3,1,'KHMT'),
	('KTMT','Kien truc may tinh',3,0,'KTMT'),
	('TKCSDL','Thiet ke co so du lieu',3,1,'HTTT'),
	('PTTKHTTT','Phan tich thiet ke he thong thong tin',4,1,'HTTT'),
	('HDH','He dieu hanh',4,0,'KTMT'),
	('NMCNPM','Nhap mon cong nghe phan mem',3,0,'CNPM'),
	('LTCFW','Lap trinh C for win',3,1,'CNPM'),
	('LTHDT','Lap trinh huong doi tuong',3,1,'CNPM')

INSERT INTO GIANGDAY VALUES
	('K11','THDC',NULL,1,2006,'2/1/2006','12/5/2006'),
	('K12','THDC',NULL,1,2006,'2/1/2006','12/5/2006'),
	('K13','THDC',NULL,1,2006,'2/1/2006','12/5/2006'),
	('K11','CTRR',NULL,1,2006,'9/1/2006','13/5/2006'),
	('K12','CTRR',NULL,1,2006,'9/1/2006','17/5/2006'),
	('K13','CTRR',NULL,1,2006,'9/1/2006','17/5/2006'),
	('K11','CSDL',NULL,2,2006,'1/6/2006','15/7/2006'),
	('K12','CSDL',NULL,2,2006,'1/6/2006','15/7/2006'),
	('K13','CTDLGT',NULL,2,2006,'1/6/2006','15/7/2006'),
	('K13','CSDL',NULL,3,2006,'1/8/2006','15/12/2006'),
	('K13','DHMT',NULL,3,2006,'1/8/2006','15/12/2006')

INSERT INTO GIAOVIEN VALUES
	('GV01','Ho Thanh Son','PTS','GS','Nam','2/5/1950','11/1/2004',5.00,2250000,'KHMT'),
	('GV02','Tran Tam Thanh','TS','PGS','Nam','17/12/1965','20/4/2004',4.50,2025000,'HTTT'),
	('GV03','Do Nghiem Phung','TS','GS','Nu','1/8/1950','23/9/2004',4.00,1800000,'CNPM'),
	('GV04','Tran Nam Son','TS','PGS','Nam','22/2/1961','12/1/2005',4.50,2025000,'KTMT'),
	('GV05','Mai Thanh Danh','ThS','GV','Nam','12/3/1958','12/1/2005',3.00,1350000,'HTTT'),
	('GV06','Tran Doan Hung','TS','GV','Nam','11/3/1953','12/1/2005',4.50,2025000,'KHMT'),
	('GV07','Nguyen Minh Tien','ThS','GV','Nam','23/11/1971','1/3/2005',4.00,1800000,'KHMT'),
	('GV08','Le Thi Tran','PTS',NULL,'Nam','26/3/1974','1/3/2005',1.69,760500,'KHMT'),
	('GV09','Nguyen To Lan','PTS','GV','Nu','31/12/1966','1/3/2005',4.00,1800000,'HTTT'),
	('GV10','Le Tran Anh Loan','KS',NULL,'Nu','17/7/1972','1/3/2005',1.86,837000,'CNPM')

INSERT INTO DIEUKIEN VALUES
	('CSDL','CTRR'),
	('CSDL','CTDLGT'),
	('CTDLGT','THDC'),
	('PTTKTT','THDC'),
	('PTTKTT','CTDLGT'),
	('DHMT','THDC'),
	('LTHDT','THDC'),
	('PTTKHTTT','CSDL')

INSERT INTO HOCVIEN VALUES
	('K1101','Nguyen Van','A','27/1/1986','Nam','TpHCM','K11'),
	('K1102','Tran Ngoc','Han','14/3/1986','Nu','Kien Giang','K11'),
	('K1103','Ha Duy','Lap','18/4/1986','Nam','Nghe An','K11'),
	('K1104','Tran Ngoc','Linh','30/3/1986','Nu','Tay Ninh','K11'),
	('K1105','Tran Minh','Long','27/2/1986','Nam','TpHCM','K11'),
	('K1106','Le Nhat','Minh','24/1/1986','Nam','TpHCM','K11'),
	('K1107','Nguyen Nhu','Nhut','27/1/1986','Nam','Ha Noi','K11'),
	('K1108','Nguyen Manh','Tam','27/2/1986','Nam','Kien Giang','K11'),
	('K1109','Phan Thi Thanh','Tam','27/1/1986','Nu','Vinh Long','K11'),
	('K1110','Le Hoai','Thuong','5/2/1986','Nu','Can Tho','K11')

INSERT INTO KETQUATHI VALUES
	('K1101','CSDL',1,'20/7/2006',10,'Dat'),
	('K1101','CTDLGT',1,'28/12/2006',9,'Dat'),
	('K1101','THDC',1,'20/5/2006',9,'Dat'),
	('K1101','CTRR',1,'13/5/2006',9.5,'Dat'),
	('K1102','CSDL',1,'20/7/2006',4,'Khong Dat'),
	('K1102','CSDL',2,'27/7/2006',4.25,'Khong Dat'),
	('K1102','CSDL',3,'10/8/2006',4.5,'Khong Dat'),
	('K1102','CTDLGT',1,'28/12/2006',4.5,'Khong Dat'),
	('K1102','CTDLGT',2,'5/1/2006',4.5,'Khong Dat'),
	('K1103','CSDL',1,'20/7/2006',3.5,'Khong Dat')



UPDATE KHOA SET TRGKHOA='GV01' WHERE MAKHOA='KHMT'
UPDATE KHOA SET TRGKHOA='GV02' WHERE MAKHOA='HTTT'
UPDATE KHOA SET TRGKHOA='GV04' WHERE MAKHOA='CNPM'
UPDATE KHOA SET TRGKHOA='GV03' WHERE MAKHOA='MTT'


UPDATE LOP SET MAGVCN='GV07' WHERE MALOP='K11'
UPDATE LOP SET MAGVCN='GV09' WHERE MALOP='K12'
UPDATE LOP SET MAGVCN='GV10' WHERE MALOP='K13'


UPDATE GIANGDAY SET MAGV='GV07' WHERE MALOP='K11' AND MAMH='THDC'
UPDATE GIANGDAY SET MAGV='GV06' WHERE MALOP='K12' AND MAMH='THDC'
UPDATE GIANGDAY SET MAGV='GV10' WHERE MALOP='K13' AND MAMH='THDC'
UPDATE GIANGDAY SET MAGV='GV02' WHERE MALOP='K11' AND MAMH='CTRR'
UPDATE GIANGDAY SET MAGV='GV02' WHERE MALOP='K12' AND MAMH='CTRR'
UPDATE GIANGDAY SET MAGV='GV08' WHERE MALOP='K13' AND MAMH='CTRR'
UPDATE GIANGDAY SET MAGV='GV05' WHERE MALOP='K11' AND MAMH='CSDL'
UPDATE GIANGDAY SET MAGV='GV09' WHERE MALOP='K12' AND MAMH='CSDL'
UPDATE GIANGDAY SET MAGV='GV10' WHERE MALOP='K13' AND MAMH='CTDLGT'
UPDATE GIANGDAY SET MAGV='GV05' WHERE MALOP='K13' AND MAMH='CTDLGT'



SELECT * FROM DBO.KHOA
SELECT * FROM DBO.LOP
SELECT * FROM DBO.MONHOC
SELECT * FROM DBO.GIANGDAY
SELECT * FROM DBO.GIAOVIEN
SELECT * FROM DBO.DIEUKIEN
SELECT * FROM DBO.KETQUATHI
SELECT * FROM DBO.HOCVIEN
